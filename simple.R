require(Matrix)

A <- Matrix(c(-128), 1, 1)
B <- Matrix(c(64,64), 1, 2)
C <- Matrix(c(0,64), 2, 1)
D <- Matrix(c(1,0,0,-64), 2, 2)
E <- Matrix(c(2), 1, 1)
F <- Matrix(c(1,3), 2, 1)


A <- Matrix(c(
	2.777731e-03, 6.944408e-04, 1.388882e-03, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00,
	6.944408e-04, 2.777761e-04, 6.944408e-04, 0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00,
	1.388882e-03, 6.944408e-04, 5.555462e-03, 6.944408e-04, 1.736103e-03, 0.000000e+00, 0.000000e+00,
	0.000000e+00, 0.000000e+00, 6.944408e-04, 2.777761e-04, 6.944408e-04, 0.000000e+00, 0.000000e+00,
	0.000000e+00, 0.000000e+00, 1.736103e-03, 6.944408e-04, 5.555462e-03, 6.944408e-04, 1.388882e-03,
	0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 6.944408e-04, 2.777761e-04, 6.944408e-04,
	0.000000e+00, 0.000000e+00, 0.000000e+00, 0.000000e+00, 1.388882e-03, 6.944408e-04, 2.777731e-03
	), 7,7, byrow=TRUE)

B <- Matrix(c(
	8.680435e-03,1.302077e-03,1.736103e-03,0.000000e+00,0.000000e+00,6.944332e-03,1.736103e-03,3.472206e-03,0.000000e+00,0.000000e+00,
	2.604154e-03,6.076359e-04,8.680515e-04,0.000000e+00,0.000000e+00,1.736103e-03,6.944408e-04,1.736103e-03,0.000000e+00,0.000000e+00,
	1.041654e-02,4.340218e-03,1.215264e-02,1.215272e-03,1.736103e-03,3.472206e-03,1.736103e-03,1.388866e-02,0.000000e+00,0.000000e+00,
	8.680515e-04,6.076359e-04,3.472206e-03,6.076359e-04,8.680515e-04,0.000000e+00,0.000000e+00,1.736103e-03,0.000000e+00,0.000000e+00,
	1.736103e-03,1.215272e-03,1.215264e-02,4.340218e-03,1.041654e-02,0.000000e+00,0.000000e+00,1.388866e-02,1.736103e-03,3.472206e-03,
	0.000000e+00,0.000000e+00,8.680515e-04,6.076359e-04,2.604154e-03,0.000000e+00,0.000000e+00,1.736103e-03,6.944408e-04,1.736103e-03,
	0.000000e+00,0.000000e+00,1.736103e-03,1.302077e-03,8.680435e-03,0.000000e+00,0.000000e+00,3.472206e-03,1.736103e-03,6.944332e-03	
	), 7, 10, byrow=TRUE)
	
C <- Matrix(c(
	8.680435e-03,2.604154e-03,1.041654e-02,8.680515e-04,1.736103e-03,0.000000e+00,0.000000e+00,
	1.302077e-03,6.076359e-04,4.340218e-03,6.076359e-04,1.215272e-03,0.000000e+00,0.000000e+00,
	1.736103e-03,8.680515e-04,1.215264e-02,3.472206e-03,1.215264e-02,8.680515e-04,1.736103e-03,
	0.000000e+00,0.000000e+00,1.215272e-03,6.076359e-04,4.340218e-03,6.076359e-04,1.302077e-03,
	0.000000e+00,0.000000e+00,1.736103e-03,8.680515e-04,1.041654e-02,2.604154e-03,8.680435e-03,
	6.944332e-03,1.736103e-03,3.472206e-03,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,
	1.736103e-03,6.944408e-04,1.736103e-03,0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,
	3.472206e-03,1.736103e-03,1.388866e-02,1.736103e-03,1.388866e-02,1.736103e-03,3.472206e-03,
	0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,1.736103e-03,6.944408e-04,1.736103e-03,
	0.000000e+00,0.000000e+00,0.000000e+00,0.000000e+00,3.472206e-03,1.736103e-03,6.944332e-03
	), 10, 7, byrow=TRUE)

D <- Matrix(c(
	5.555418e-02,1.388858e-02,2.951327e-02,1.302077e-03,1.736103e-03,1.736087e-02,5.208309e-03,2.083308e-02,0.000000e+00,0.000000e+00,
	1.388858e-02,5.555426e-03,1.519066e-02,9.765579e-04,1.302077e-03,2.604154e-03,1.215272e-03,8.680435e-03,0.000000e+00,0.000000e+00,
	2.951327e-02,1.519066e-02,8.680355e-02,1.519066e-02,2.951327e-02,3.472206e-03,1.736103e-03,3.472174e-02,1.736103e-03,3.472206e-03,
	1.302077e-03,9.765579e-04,1.519066e-02,5.555426e-03,1.388858e-02,0.000000e+00,0.000000e+00,8.680435e-03,1.215272e-03,2.604154e-03,
	1.736103e-03,1.302077e-03,2.951327e-02,1.388858e-02,5.555418e-02,0.000000e+00,0.000000e+00,2.083308e-02,5.208309e-03,1.736087e-02,
	1.736087e-02,2.604154e-03,3.472206e-03,0.000000e+00,0.000000e+00,2.777701e-02,6.944332e-03,1.388866e-02,0.000000e+00,0.000000e+00,
	5.208309e-03,1.215272e-03,1.736103e-03,0.000000e+00,0.000000e+00,6.944332e-03,2.777731e-03,6.944332e-03,0.000000e+00,0.000000e+00,
	2.083308e-02,8.680435e-03,3.472174e-02,8.680435e-03,2.083308e-02,1.388866e-02,6.944332e-03,8.333103e-02,6.944332e-03,1.388866e-02,
	0.000000e+00,0.000000e+00,1.736103e-03,1.215272e-03,5.208309e-03,0.000000e+00,0.000000e+00,6.944332e-03,2.777731e-03,6.944332e-03,
	0.000000e+00,0.000000e+00,3.472206e-03,2.604154e-03,1.736087e-02,0.000000e+00,0.000000e+00,1.388866e-02,6.944332e-03,2.777701e-02
	), 10, 10, byrow=TRUE)

E <- Matrix(c(2.728048e-01, 9.101086e-02, 5.477797e-01, 9.161849e-02, 5.581962e-01, 9.448306e-02, 2.849574e-01), 7, 1)
F <- Matrix(c(1.634516e+00, 5.456499e-01, 2.479009e+00, 5.595385e-01, 1.697015e+00, 8.214896e-01, 2.740634e-01, 2.494199e+00, 2.827439e-01, 8.527390e-01), 10, 1)

eliminate <- function(A,B,C,D,E,F) {
	# A(1,1)=L*U
	lu <- expand(lu(A))
	L <- lu$L
	U <- lu$U

	# 2) A(1,2)=(L*U)^-1*A(1,2)
	
	B1 = solve(A) %*% B
		
	# B1 <- solve(A) %*% B

	# 3) b(1)=(L*U)^-1*b(1)

	E1 <- solve(A) %*% E

	# 4) A(2,2)=A(2,2)-A(2,1)*A(1,2)

	D1 <- D - C %*% B1

	# 5) b(2)=b(2)-A(2,1)*b(1)

	F1 <- F - C %*% E1
	
	return(c(A=A, B=B1, C=C, D=D1, E=E1, F=F1, L=L, U=U))
}